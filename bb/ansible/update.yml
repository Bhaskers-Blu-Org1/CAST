#  sudo ansible-playbook -i hosts  <this.yml>
 # hosts must set RPMDIR in [all.vars] section

#check for RPMDIR early before doing upgrade
- hosts: all
  tasks:
  - name: check all nodes for RPM directory
    command: /usr/bin/file {{RPMDIR}} 
    any_errors_fatal: true

#section for stopping daemons, removing RPMs, cleaning up
- hosts: localhost
  tasks:
    - debug:
         msg: stop CSM and burstbuffer
- name: Include stop of CSM        
  import_playbook: csmStop.yml 
- name: Include stop of bb       
  import_playbook: bbStop.yml
- name: Include uninstall of CSM       
  import_playbook: csmUninstall.yml  
- name: Include bb uninstall       
  import_playbook: bbUninstall.yml    

#section for installing RPMs, starting daemons
- hosts: localhost
  tasks:
    - debug:
         msg: install csm and bb
- name: Include csm install     
  import_playbook: csmInstall.yml 
- name: Include bb install      
  import_playbook: bbInstall.yml 
- name: Include csm start     
  import_playbook: csmStart.yml 
- name: Include bb start      
  import_playbook: bbStart.yml  
   

